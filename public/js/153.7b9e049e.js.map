{"version":3,"file":"js/153.7b9e049e.js","mappings":"4iBAuCA,MAAM,MAAEA,IAAUC,EAAAA,EAAAA,KACZC,GAAOC,EAAAA,EAAAA,IAAI,CACfC,QAAS,GACTC,WAAY,GACZC,OAAQ,GACRC,OAAQ,GACRC,YAAa,CACX,CACEC,OAAQ,oBACRC,QAAS,GACTC,GAAI,GAEN,CAAEF,OAAQ,aAAcC,QAAS,GAAIC,GAAI,GACzC,CAAEF,OAAQ,mBAAoBC,QAAS,GAAIC,GAAI,GAC/C,CAAEF,OAAQ,SAAUC,QAAS,GAAIC,GAAI,IAEvCC,SAAU,CAAEC,IAAK,GAAIP,OAAQ,GAAID,WAAY,MAEzCS,GAAQX,EAAAA,EAAAA,IAAI,IACZQ,GAAKI,EAAAA,EAAAA,MAAWC,OAAOL,GAEvBM,EAAO,KACX,MAAMC,EAAOhB,EAAKiB,MAClBD,EAAKV,YAAcU,EAAKV,YAAYY,QAAQC,GAC1CA,EAAKX,QAAQY,MAAMC,KAAUA,EAAIC,cAEnCN,EAAKN,SAASC,IAAMY,EAAAA,EAAAA,YAChBP,EAAKV,aACPU,EAAKV,YAAYkB,SAASL,IACxBA,EAAKX,QAAUW,EAAKX,QAAQU,QAAQC,KAAWA,EAAKG,eAGxDxB,EAAM,QAAU,gBAAeW,IAAMO,EAAM,eACxCS,MAAK,KACJC,EAAAA,EAAAA,KAAY,CAAEC,KAAM,qBAErBC,OAAOC,IACNjB,EAAMK,MAAQY,EAAIC,SAAS9B,KAC3BA,EAAKiB,MAAMX,YAAYkB,SAASL,IACF,IAAxBA,EAAKX,QAAQuB,SACjBZ,EAAKX,QAAUW,EAAKX,QAAQU,QAAQC,KAAWA,EAAKG,oB,OAI5DxB,EAAM,MAAQ,gBAAeW,KAC1BgB,MAAMO,IACLhC,EAAKiB,MAAQe,EAAIhC,KACjBuB,EAAAA,EAAAA,WAAiB,cAAeS,EAAIhC,KAAKU,SAASC,QAEnDiB,OAAM,IAAMF,EAAAA,EAAAA,KAAY,CAAEO,KAAM,qBAEnCC,EAAAA,EAAAA,KACE,IAAMlC,EAAKiB,QACVA,IACCM,EAAAA,EAAAA,WAAiB,iBAAkBN,EAAMP,SAASN,QAClDmB,EAAAA,EAAAA,WAAiB,qBAAsBN,EAAMP,SAASP,cAExD,CAAEgC,MAAM,EAAMC,WAAW,KAG3BC,EAAAA,EAAAA,KAAgB,IAAMd,EAAAA,EAAAA,WAAiB,cAAe,M,6kBChGtD,MAAMe,EAAc,EAEpB","sources":["webpack://client/./src/components/admin/products/ChangeItem.vue","webpack://client/./src/components/admin/products/ChangeItem.vue?705e"],"sourcesContent":["<template>\r\n  <div class=\"content__top\">\r\n    <ul class=\"breadcrumbs\">\r\n      <li class=\"breadcrumbs__item\">\r\n        <router-link :to=\"{ name: 'adminMenu' }\" class=\"breadcrumbs__link\">\r\n          Меню\r\n        </router-link>\r\n      </li>\r\n      <li class=\"breadcrumbs__item\">\r\n        <router-link :to=\"{ name: 'adminProducts' }\" class=\"breadcrumbs__link\">\r\n          Товары\r\n        </router-link>\r\n      </li>\r\n\r\n      <li class=\"breadcrumbs__item\">\r\n        <span class=\"breadcrumbs__link\" disabled> Изменение товара </span>\r\n      </li>\r\n    </ul>\r\n  </div>\r\n  <BaseSpinner v-if=\"store.isLoading\"></BaseSpinner>\r\n\r\n  <ItemForm\r\n    v-else\r\n    :text=\"'сохранить изменения'\"\r\n    v-model:data=\"data\"\r\n    @submit=\"save\"\r\n    :formError=\"error\"\r\n  >\r\n  </ItemForm>\r\n</template>\r\n<script setup>\r\nimport ItemForm from '@/components/admin/products/ItemForm.vue'\r\nimport { ref, watch, onBeforeUnmount } from 'vue'\r\nimport useApi from '@/hooks/useApi'\r\nimport router from '@/router'\r\nimport { useRoute } from 'vue-router'\r\n\r\nimport { store } from '@/store/store'\r\nimport BaseSpinner from '@/components/small/BaseSpinner.vue'\r\nconst { fetch } = useApi()\r\nconst data = ref({\r\n  volumes: [],\r\n  categories: [],\r\n  brands: [],\r\n  images: [],\r\n  description: [\r\n    {\r\n      header: 'Полезные свойства',\r\n      content: [],\r\n      id: 1\r\n    },\r\n    { header: 'Преминение', content: [], id: 2 },\r\n    { header: 'Противопоказания', content: [], id: 3 },\r\n    { header: 'Состав', content: [], id: 4 }\r\n  ],\r\n  recomend: { ids: [], brands: [], categories: [] }\r\n})\r\nconst error = ref({})\r\nconst id = useRoute().params.id\r\n\r\nconst save = () => {\r\n  const body = data.value\r\n  body.description = body.description.filter((item) =>\r\n    item.content.some((obj) => !!obj.paragraph)\r\n  )\r\n  body.recomend.ids = store.recomendIds\r\n  if (body.description) {\r\n    body.description.forEach((item) => {\r\n      item.content = item.content.filter((item) => !!item.paragraph)\r\n    })\r\n  }\r\n  fetch('patch', `api/products/${id}`, body, 'SaveLoading')\r\n    .then(() => {\r\n      router.push({ name: 'adminProducts' })\r\n    })\r\n    .catch((err) => {\r\n      error.value = err.response.data\r\n      data.value.description.forEach((item) => {\r\n        if (item.content.length === 1) return\r\n        item.content = item.content.filter((item) => !!item.paragraph)\r\n      })\r\n    })\r\n}\r\nfetch('get', `api/products/${id}`)\r\n  .then((res) => {\r\n    data.value = res.data\r\n    store.updateProp('recomendIds', res.data.recomend.ids)\r\n  })\r\n  .catch(() => router.push({ path: 'adminNotFound' }))\r\n\r\nwatch(\r\n  () => data.value,\r\n  (value) => {\r\n    store.updateProp('recomendBrands', value.recomend.brands)\r\n    store.updateProp('recomendCategories', value.recomend.categories)\r\n  },\r\n  { deep: true, immediate: true }\r\n)\r\n\r\nonBeforeUnmount(() => store.updateProp('recomendIds', []))\r\n</script>\r\n","import script from \"./ChangeItem.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ChangeItem.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["fetch","useApi","data","ref","volumes","categories","brands","images","description","header","content","id","recomend","ids","error","useRoute","params","save","body","value","filter","item","some","obj","paragraph","store","forEach","then","router","name","catch","err","response","length","res","path","watch","deep","immediate","onBeforeUnmount","__exports__"],"sourceRoot":""}